---
layout: post
title: Fixing a mistake in your git history
date: '2015-04-22T21:08:00.000+10:00'
author: Zarah Dominguez
tags:
- git
modified_time: '2015-04-22T21:08:45.498+10:00'
blogger_id: tag:blogger.com,1999:blog-8588450866181483028.post-5424734702179850648
blogger_orig_url: http://www.zdominguez.com/2015/04/fixing-mistake-in-your-git-history.html
---

I have been using git for about five years now, but I definitely get stumped by it a lot. It is so powerful it's daunting. There has been a <strike>couple</strike> lot of times where I had been too careless and reliant on my fingers' add-commit-push muscle memory that I realised I have made a mistake too late. I have always been a proponent of clean, atomic commits, and when I find my commits all messed up, I hit myself in the head.<br /><br />So, to stop myself from pulling my hair out looking for all the right StackOverflow answers that I KNOW I'VE SEEN THE SOLUTION BEFORE WHERE THE HELL IS IT???, I am writing the steps down to remind myself.<br /><br /><b>SCENARIO</b>:<br />- I have committed some files in a previous commit that should not be there<br />- I want to REMOVE those files from that commit<br />- I want to preserve all other commits after that bad commit<br /><br /><b>CAVEATS</b>:<br />- I am working in a local branch<br />- I will be removing those files forever<br />- I AM WORKING IN A LOCAL BRANCH*<br /><br /><b>SOLUTION</b>:<br />1. Find out which commit you want to go back to.<br /><code>$ git log</code><br /><br />This should give you something like:<br /><pre class="brush:shell">zarah.dominguez@R5003334 swipe-to-refresh-demo (master) $ git log<br />commit a6c00638b3d466a61e3381a98e6b44cf2d085164<br />Author: Zarah Dominguez<br />Date:   Tue Jun 17 16:34:50 2014 +0800<br /><br />    Removed dependency on ButterKnife.<br /><br />commit e25c6862a79270921a24d6bf2a9eb07cc3f03b36<br />Author: Zarah Dominguez<br />Date:   Tue Jun 17 16:07:33 2014 +0800<br /><br />    First commit</pre><br />If you just want the commit messages:<br /><code>$ git log --oneline</code><br /><br /><br />2. Create a new branch based on the bad commit.<br /><code>$ git checkout -b fix-that-shit e25c686</code><br /><br />What this does is create a new branch named <code>fix-that-shit</code>, whose <code>HEAD</code> points to commit <code>e25c686</code>. The <code>-b</code> switch tells git to go to that newly-created branch.<br /><br />3. Do your thing. In this case, I want to remove files.<br /><span style="font-family: monospace;">$ git rm BadFile.java</span><br /><span style="font-family: monospace;">rm 'BadFile.java'</span><br /><span style="font-family: monospace;">$ git rm AnotherBadFile.java</span><br /><span style="font-family: monospace;">rm 'AnotherBadFile.java'</span><br /><br />4. Let git know that you've overcome your stupidity and are now saying sorry.<br /><span style="font-family: monospace;">$ git commit --amend</span><br /><br />An editor will open, and here you can edit the commit message.<br /><br />5. Go back to the original branch. In my case, it is master.<br /><span style="font-family: monospace;">$ git checkout master</span><br /><br />6. Give this branch your changes.<br /><span style="font-family: monospace;">$ git rebase fix-that-shit</span><br /><br />7. Check your log. git might try and do it's thing, and do funny merges. So you might end up with a new commit in your history, something like:<br /><pre class="brush:shell">zarah.dominguez@R5003334 swipe-to-refresh-demo (master) $ git log<br />commit 3e08701339c35301caf269058eab6359c9d87ecd<br />Author: Zarah Dominguez<br />Date:   Tue Jun 17 16:34:50 2014 +0800<br /><br />    Removed dependency on ButterKnife.<br /><br />commit ca57ac7974d7a422a2225612404cb6bd555acfc4<br />Author: Zarah Dominguez <br />Date:   Tue Jun 17 16:07:33 2014 +0800<br /><br />    First commit<br /><br />commit 679ad41bedb2d61fbea36e39e334074b7de66dcd<br />Author: Zarah Dominguez<br />Date:   Tue Jun 17 16:07:33 2014 +0800<br /><br />    First commit</pre><br /><br />7b. Examine the two commits, and you'll notice that the second in the list contains the file we just removed. I want to chuck that out completely, so I will do a rebase. This will take me back to the first commit in interactive mode:<br /><code>$ git rebase -i --root</code><br /><br />Now I can trash that bad commit by adding a pound sign (or fine, hashtag) before that commit's SHA:<br /><code>pick 679ad41 First commit</code><br /><code>#pick ca57ac7 First commit</code><br /><code>pick 3e08701 Removed dependency on ButterKnife.</code><br /><br />8. Check your logs again, and verify that the file is now nowhere to be found.<br /><pre class="brush:shell">zarah.dominguez@R5003334 swipe-to-refresh-demo (master) $ git log<br />commit a6c00638b3d466a61e3381a98e6b44cf2d085164<br />Author: Zarah Dominguez<br />Date:   Tue Jun 17 16:34:50 2014 +0800<br /><br />    Removed dependency on ButterKnife.<br /><br />commit e25c6862a79270921a24d6bf2a9eb07cc3f03b36<br />Author: Zarah Dominguez<br />Date:   Tue Jun 17 16:07:33 2014 +0800<br /><br />    First commit</pre><br /><br />9. Now kill and bury that shit:<br /><code>$ git branch -d fix-that-shit</code><br /><br />10. You will then need to force-push your changes if you have a remote branch. Hence the DO NOT DO UNLESS YOU ARE THE ONLY ONE USING THE BRANCH.<br /><span style="font-family: monospace;">$ git push master --force</span><br /><br /><br /><br />I am sure there is a more concise way to do this, but doing the verbose solution here for posterity.<br /><br /><br />-----------<br />* I cannot stress this enough. DO NOT DO THIS IF YOU ARE SHARING YOUR BRANCH WITH SOMEBODY ELSE. If you do, you automatically give them license to punch you in the face. (It can be a remote branch, as long as YOU ARE NOT SHARING IT WITH SOMEBODY ELSE)