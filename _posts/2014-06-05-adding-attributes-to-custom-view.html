---
layout: post
title: Adding attributes to a custom view
date: '2014-06-05T17:24:00.001+10:00'
author: Zarah Dominguez
tags:
- EditText
- android
- layout
modified_time: '2014-06-06T03:02:21.812+10:00'
thumbnail: http://3.bp.blogspot.com/-5U8Vj7Dea5E/U5AZzCIJ4BI/AAAAAAAABJc/BjeIfMRrNpA/s72-c/Screen+Shot+2014-06-05+at+3.18.02+PM.png
blogger_id: tag:blogger.com,1999:blog-8588450866181483028.post-6564421430248280506
blogger_orig_url: http://www.zdominguez.com/2014/06/adding-attributes-to-custom-view.html
---

There are times when using the default Android Views just doesn't cut it and you need to create your own version of a View. So how exactly do you do that? It's as simple as subclassing the View! But what if you want to add customizable attributes? Here's how.<br /><br />Let's say I am creating a form-filling application and I want some of the EditTexts in the form to be required. However, I am <i style="font-weight: bold;">so</i>&nbsp;tired of having to implement the error checking for each and every one of those fields. What I will do is create my own EditText that will do the validation for me if that particular field is required. Let's do it.<br /><br />Step 1: Create your custom view and create fields for the attributes you want. In this case, I want an EditText that will show the default EditText error display if the user has not put in any value. <br /><pre class="brush:java">public class RequiredEditText extends EditText {<br />   private boolean mRequired;<br />   private String mErrorMessage;<br /><br />   public RequiredEditText(Context context) {<br />      super(context);<br />   }<br /><br />   /**<br />   * Set this EditText's requirement validation. The error message<br />   * will be set to <code>null</code> by default if not provided.<br />   * <br />   * @param required<br />   * @param errorMessage (optional)<br />   */<br />   public void setRequired(boolean required, String errorMessage) {<br />      this.mRequired = required;<br />      this.mErrorMessage = errorMessage;<br />  <br />      invalidate();<br />      requestLayout();<br />   }<br /> <br />   public void setRequired(boolean required) {<br />      setRequired(required, null);<br />   }<br /><br />   /**<br />   * Lets you know if this field is set as required or not<br />   * @return<br />   */<br />   public boolean isRequiredField() {<br />   return mRequired;<br />   }<br />}</pre>Step 2: If a field is required, we want the default error message to appear (with our own error message, of course). If the user fills in the EditText, we want the error to disappear.  <br /><pre class="brush:java">public class RequiredEditText extends EditText {<br />   private boolean mRequired;<br />   private String mErrorMessage;<br /><br />   public RequiredEditText(Context context) {<br />      super(context);<br />   }<br /><br />   /**<br />   * Set this EditText's requirement validation. The error message<br />   * will be set to <code>null</code> by default if not provided.<br />   * <br />   * @param required<br />   * @param errorMessage (optional)<br />   */<br />   public void setRequired(boolean required, String errorMessage) {<br />      this.mRequired = required;<br />      this.mErrorMessage = errorMessage;<br />  <br />      manageRequiredField(required);<br />  <br />      invalidate();<br />      requestLayout();<br />   }<br /> <br />   public void setRequired(boolean required) {<br />      setRequired(required, null);<br />   }<br /><br />   private void manageRequiredField(boolean required) {<br />      // If we are required, set the listeners<br />      if(required) {<br />         setOnFocusChangeListener(mFocusChangeListener);<br />         addTextChangedListener(mTextWatcher);<br />      } else {<br />         // In case there is an error message already, clear it<br />         setError(null);<br />   <br />         // Remove the listeners<br />         setOnFocusChangeListener(null);<br />         removeTextChangedListener(mTextWatcher);<br />      }<br />   }<br /><br />   /**<br />   * Lets you know if this field is set as required or not<br />   * @return<br />   */<br />   public boolean isRequiredField() {<br />      return mRequired;<br />   }<br /><br />   OnFocusChangeListener mFocusChangeListener = new OnFocusChangeListener() {<br /><br />      @Override<br />      public void onFocusChange(View v, boolean hasFocus) {<br />         // If the focus was removed from the field and it IS required,<br />         // check if the user has put in something<br />         if(!hasFocus &amp;&amp; mRequired){<br />            isRequiredFieldFilled();<br />         }<br />      }<br />   };<br /> <br />   TextWatcher mTextWatcher = new TextWatcher() {<br /><br />      @Override<br />      public void onTextChanged(CharSequence s, int start, int before, int count) {<br />         // Once the user types in something, remove the error<br />         setError(null);<br />      }<br /><br />      @Override<br />      public void beforeTextChanged(CharSequence s, int start, int count, int after) { /* do nothing */ }<br /><br />      @Override<br />      public void afterTextChanged(Editable s) { /* do nothing */ }   <br />   };<br /><br />   private boolean isRequiredFieldFilled() {<br />      // If the EditText is empty, show the error message<br />      if(TextUtils.isEmpty(getText().toString().trim())){<br />         showRequiredErrorDrawable();<br />         return false;<br />      }<br />      return true;<br />   }<br /><br />   private void showRequiredErrorDrawable() {<br />      setError(mErrorMessage);<br />   }<br />}</pre>Step 3: Now it's time to add the fields to the Layout Editor. Create an <code>attrs.xml</code> file in <code>/res</code> if there isn't one already. Declare a <code>styleable</code> and include the attributes you want to appear in the Layout Editor. <br /><pre class="brush:xml"><resources><br />   <declare-styleable name="RequiredEditText"><br />       <attr format="boolean" name="required"><br />       <attr format="string" name="errorMessage"><br />   </attr></attr></declare-styleable><br /></resources><br /></pre>The name of the <code>styleable</code> does not need to match your custom view class name, but doing so makes it more readable and maintainable.<br /><br /> Step 4: Go back to your custom view implementation and add constructors that take in an <code>AttributeSet</code>. <br /><pre class="brush:java">public RequiredEditText(Context context, AttributeSet attrs, int defStyle) {<br />   super(context, attrs, defStyle);<br />   init(attrs);<br />}<br /><br />public RequiredEditText(Context context, AttributeSet attrs) {<br />   super(context, attrs);<br />   init(attrs);<br />}<br /><br />private void init(AttributeSet attrs) { <br />   TypedArray a=getContext().obtainStyledAttributes(<br />      attrs,<br />      R.styleable.RequiredEditText);<br /><br />   try {<br />      setRequired(a.getBoolean(R.styleable.RequiredEditText_required, false), <br />            a.getString(R.styleable.RequiredEditText_errorMessage));<br />   } finally {<br />      //Don't forget this, we need to recycle<br />      a.recycle();<br />   }<br />}<br /></pre>Step 5: Go to the Layout Editor and look for "Custom &amp; Library Views" in the Palette (you may have to click on "Refresh" several times before your custom view appears in the list). Add the custom view to your layout and check out the properties panel!<br />&nbsp; <a href="http://3.bp.blogspot.com/-5U8Vj7Dea5E/U5AZzCIJ4BI/AAAAAAAABJc/BjeIfMRrNpA/s1600/Screen+Shot+2014-06-05+at+3.18.02+PM.png" imageanchor="1"><img border="0" src="http://3.bp.blogspot.com/-5U8Vj7Dea5E/U5AZzCIJ4BI/AAAAAAAABJc/BjeIfMRrNpA/s320/Screen+Shot+2014-06-05+at+3.18.02+PM.png" /></a><br /><br />&nbsp;As always, the code is in <a href="https://github.com/zmdominguez/custom-view">GitHub</a>.