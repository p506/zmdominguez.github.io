---
layout: post
title: Adding Preferences On-The-Fly
date: '2012-05-22T17:49:00.001+10:00'
author: Zarah Dominguez
tags:
- shared preferences
- android
modified_time: '2012-05-22T17:49:16.569+10:00'
blogger_id: tag:blogger.com,1999:blog-8588450866181483028.post-6535886254769330142
blogger_orig_url: http://www.zdominguez.com/2012/05/adding-preferences-on-fly.html
---

(Make appropriate whooshing sounds)<br /><br />Today, I will show you how to add preferences to your SharedPreferences (confused yet?) programatically. In an app that I am doing, I wanted to present a <a href="http://developer.android.com/reference/android/preference/ListPreference.html">ListPreference</a>&nbsp;to the user from the SharedPreferences page. However, the values contained in this list is not known at compile time. (Think Facebook groups that differ per user, or Twitter lists, or things like such, and I want to set a default option.)<br /><br />Anyway, here's what I did to make this work. I added a preference in my PreferenceScreen, a sort of placeholder, if you will. Here is my <code>ListPreference</code>:<br /><pre class="brush:xml">&lt;PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android" &gt;<br /><br /> &lt;PreferenceCategory android:title="@string/pref_settings_header"&gt;<br />  &lt;ListPreference android:key="@string/pref_key_default_group" android:title="@string/pref_default_group"/&gt;<br /> &lt;/PreferenceCategory&gt;<br /><br />&lt;/PreferenceScreen&gt;</pre>And then in the class that handles the SharedPreferences, I get the values that I want displayed and plug them in to the placeholder preference. I will not bother to explain here, just heavily commenting the code:<br /><pre class="brush:java">public class UserPreferences extends PreferenceActivity {<br /><br /> private static final String LOG_TAG = "UserPreferences";<br /> <br /> @Override<br /> public void onCreate(Bundle savedInstanceState) {<br />  super.onCreate(savedInstanceState);<br /><br />  // Load the preferences from an XML resource<br />  addPreferencesFromResource(R.xml.my_apps_prefs);<br />  <br />  // Manage the "Default Group" preference<br />  addDefaultGroupPrefs();  <br /> }<br /> <br /> <br /> private void addDefaultGroupPrefs() {<br />  // Get our "placeholder" preference. I prefer to use strings instead of hard-coding the preference key.<br />  // The value passed into findPreference is the value in the android:key parameter in the preference XML file.<br />  ListPreference groupsListPrefs = (ListPreference) findPreference(getString(R.string.pref_key_default_group));<br />  <br />  // Get your groups, this may come from a utility class or wherever<br />  // In this example, I have a custom object that has a "name" and an "id"<br />  List&lt;CustomGroup&gt; myGroups = getMyGroups();<br />  if (myGroups == null) {<br />   // Disable the preference if we don't have a list<br />   groupsListPrefs.setEnabled(false);<br />  } else {<br />   // Enable the preference if we have a list<br />   groupsListPrefs.setEnabled(true);<br /><br />   // We split the list into names and IDs<br />   // We show the names in the list, and the values as the entries<br />   List&lt;String&gt; groupNames = new ArrayList&lt;String&gt;();<br />   List&lt;String&gt; groupIds = new ArrayList&lt;String&gt;();<br />   for (CustomGroup group : myGroups){<br />    groupIds.add(group.getId());<br />    groupNames.add(group.getName());<br />    <br />    // I guess you can add directly to a String[]<br />    // just make sure the order is preserved (name1=id1, name2=id2, etc)<br />   }<br />   <br />   // These should be user-readable strings<br />   groupsListPrefs.setEntries(groupNames.toArray(new String[groupNames.size()]));<br />   <br />   // These are the actual values to be saved in the XML file<br />   groupsListPrefs.setEntryValues(groupIds.toArray(new String[groupIds.size()]));<br />  }<br /> }<br /> <br /> private List&lt;customgroup&gt; getMyGroups(){<br />  // do work here, query server or db or whatever<br />  // return the list of groups<br /> }<br />}</pre><br />And we're done. :)<br /><br />