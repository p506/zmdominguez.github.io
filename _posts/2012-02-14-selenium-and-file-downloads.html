---
layout: post
title: Selenium and File Downloads
date: '2012-02-14T15:35:00.000+11:00'
author: Zarah Dominguez
tags:
- selenium
- JUnit
- file download
modified_time: '2012-02-14T15:42:54.703+11:00'
blogger_id: tag:blogger.com,1999:blog-8588450866181483028.post-8440745014661270945
blogger_orig_url: http://www.zdominguez.com/2012/02/selenium-and-file-downloads.html
---

Lately, one of my tasks has been to automate regression tests on one of our apps. Since this is a web app, we are using <a href="http://seleniumhq.org/">Selenium</a>. Here, I enumerate the steps to configure Firefox for file downloading using Selenium and JUnit by foregoing the downloads dialog box.  <br /><br /><b>Setting up the profile</b><br />We will create a new profile to be used for testing. A profile is simply a set of configuration that Firefox will use when you start it. You can use your existing profile as well, but I opted to create a new one so that the Firefox instance for testing will be as pristine as possible (i.e. no unnecessary plugins, no bookmarks, etc). A note: I am working on a Windows machine.<br /><ol><li>Bring up the command prompt and start the profile chooser by typing in <code>firefox.exe -ProfileManager -no-remote</code></li><li>Click on <code>Create Profile</code>.</li><li>Enter the profile name you wish to use. I suggest you include the name of your project instead of just naming it "Test".</li><li>Click on <code>Choose Folder</code> and navigate to the folder where you wish to store the profile files. Make sure you can access that folder easily; write the path down because you will need this in JUnit.</li><li>Click on <code>Finish</code>.</li><li>You will be brought back to the profile chooser dialog. Click on the <code>Don't ask at start-up checkbox</code>.</li></ol><div>Note: To make Firefox use your original configurations when you are browsing, bring up the profile chooser dialog, choose the profile named <i>default</i>, and start Firefox.</div><div><br /></div><div><b>Configuring Firefox</b></div><div>Now we will configure Firefox to behave like how we want it to.<br /><ol><li>From the profile chooser dialog, highlight your test profile and click the <code>Start Firefox button</code>.</li><li>(Optional if Firefox is not your default browser) Uncheck <code>"Always perform this check when starting Firefox"</code>.</li><li>Click on <code>Tools &gt; Options</code>. We will go through the steps for each tab in the <code>Options</code> dialog box.</li><li>General tab</li><ul><li>Under Startup, choose <code>Show a blank page</code> from the <code>When Firefox starts</code> dropdown.</li><li>Under Downloads, uncheck the <code>Show the Downloads window when downloading a file</code> checkbox.</li><li>Still under Downloads, click on <code>Browse</code> for the <code>Save files to</code> option. Navigate to the folder where you want Firefox to put downloaded files. Take note of this folder as well because we will use this in JUnit.</li></ul><li>Tabs tab</li><ul><li>Uncheck <code>Open new windows in a new tab instead</code> and uncheck all warnings.</li></ul><li>Content tab</li><ul><li>Uncheck <code>Block pop-up windows</code>.</li></ul><li>(Optional) Privacy tab</li><ul><li>Under History, choose <code>Never remember history</code> from the <code>Firefox will:</code> dropdown.</li></ul><li>Advanced tab</li><ul><li>Under the General sub-tab, uncheck <code>Use autoscrolling</code> and uncheck <code>Always check to see if Firefox is the default browser on startup</code>.</li><li>If you will be using a proxy server, choose the Network sub-tab and input your proxy settings there.</li></ul></ol><div><b>Adding MIME Types</b></div></div><div>Now we need to tell Firefox how to handle downloading each specific type of file.</div><div><ol><li>Navigate to the folder where you saved your custom profile and open the <code>mimeTypes.rdf</code> file in a text editor.</li><li>Add the following lines towards the end of the file, right above the closing <code>&lt;/RDF:RDF&gt;</code> tag.</li><pre class="brush:xml">&lt;RDF:Seq RDF:about="urn:mimetypes:root"&gt;<br /> &lt;RDF:li RDF:resource="urn:mimetype:text/plain"/&gt;<br />&lt;/RDF:Seq&gt;<br />   <br />&lt;RDF:Description RDF:about="urn:mimetype:handler:text/plain" NC:alwaysAsk="false" NC:saveToDisk="true"&gt;<br />        &lt;NC:externalApplication RDF:resource="urn:mimetype:externalApplication:text/plain"/&gt;<br />&lt;/RDF:Description&gt;<br /><br />&lt;RDF:Description RDF:about="urn:mimetype:text/plain" NC:value="text/plain" NC:editable="true" NC:fileExtensions="txt" NC:description="Text Document"&gt;<br /> &lt;NC:handlerProp RDF:resource="urn:mimetype:handler:text/plain"/&gt;<br />&lt;/RDF:Description&gt;</pre><br />What we did there is we told Firefox to directly download files with MIME type <code>text/plain</code>. If you need to test downloading other file types like <i>.doc</i>&nbsp;or <i>.pdf</i>, you would need to add their MIME types to this file too. <br /><li>There are two ways to add MIME types to the mimeTypes.rdf file.</li><ul><li>Via the Firefox Applications GUI</li><ul><li>From Firefox, choose <code>Tools &gt; Options &gt; Applications</code></li><li>If you have previously downloaded a file of the required MIME type, look for it in the list. In the dropdown menu on the right, under <code>Action</code> choose <code>Save File</code>.</li><li>If the MIME type you want is not in the list, you would need to go to a website that allows you to download a sample file. If the file downloads automatically without showing the download pop-up, you would not have to do anything. If the pop-up shows up, activate the <code>Save File</code> radio button and check the <code>Do this automatically for files like this from now on</code> checkbox and click <code>Okay</code>.</li></ul><li>Manually editing the file</li>&nbsp;<span style="color: red;"><b>Note</b>: This is generally not the advised way to edit the file due to its complexity. Care is required! </span><ul><li>Open the <code>mimeTypes.rdf</code> file.</li><li>Look for the <code>RDF:Seq</code> node and add your desired MIME type.</li><pre class="brush:xml">&lt;RDF:Seq RDF:about="urn:mimetypes:root"&gt;<br />   &lt;RDF:li RDF:resource="urn:mimetype:text/plain"/&gt;<br />   <span style="color: red;">&lt;RDF:li RDF:resource="urn:mimetype:application/pdf"/&gt;</span><br />&lt;/RDF:Seq&gt;</pre><li>Add the <code>RDF: Description</code> nodes for that MIME type.</li><pre class="brush:xml">&lt;RDF:Description RDF:about="urn:mimetype:application/pdf" NC:fileExtensions="pdf" NC:description="Adobe Acrobat Document" NC:value="application/pdf" NC:editable="true"&gt;<br /> &lt;NC:handlerProp RDF:resource="urn:mimetype:handler:application/pdf"/&gt;<br />&lt;/RDF:Description&gt;<br /><br />&lt;RDF:Description RDF:about="urn:mimetype:handler:application/pdf" NC:saveToDisk="true" NC:alwaysAsk="false" /&gt;</pre></ul></ul></ol>To use this profile in our Selenium test:<br /><pre class="brush:java">FirefoxProfile profile = new FirefoxProfile(new File("path/to/your/profile"));<br />  <br />// We can also set the download folder via code<br />File testFile = new File("path/to/download/folder");<br />String downloadFolder = testFile.getAbsolutePath();<br />profile.setPreference("browser.download.dir", downloadFolder);<br />  <br />WebDriver driver = new FirefoxDriver(profile);</pre> And you're done. :) </div>